!function(a){window.jQuery||alert("jQuery is required."),jQuery(function(){a.call(null,jQuery)})}(function(a){var b=function(){var g,h,b=1600,d=WebUploader,e=d.Uploader;if(a(".uploader-container"),!e.support())throw alert("Web Uploader 不支持您的浏览器！"),new Error("WebUploader does not support the browser you are using.");return e.register({"before-send-file":"cropImage"},{cropImage:function(a){var c,e,b=a._cropData;return a=this.request("get-file",a),e=d.Deferred(),c=new d.Lib.Image,e.always(function(){c.destroy(),c=null}),c.once("error",e.reject),c.once("load",function(){c.crop(b.x,b.y,b.width,b.height,b.scale)}),c.once("complete",function(){var b,d;try{b=c.getAsBlob(),d=a.size,a.source=b,a.size=b.size,a.trigger("resize",b.size,d),e.resolve()}catch(f){console.log(f),e.resolve()}}),a._info&&c.info(a._info),a._meta&&c.meta(a._meta),c.loadFromBlob(a.source),e.promise()}}),{init:function(a){g=new e({pick:{id:"#filePicker",multiple:!1},thumb:{quality:70,allowMagnify:!1,crop:!1},chunked:!1,compress:!1,server:"comm/attachment/uploader",swf:"jslib/webuploader/Uploader.swf",fileNumLimit:1,onError:function(){var a=[].slice.call(arguments,0);alert(a.join("\n"))}}),g.on("fileQueued",function(c){h=c,g.makeThumb(h,function(b,c){return b?(alert("不能预览"),void 0):(a(c),void 0)},b,1)}),g.on("uploadFinished",function(){parent.onUploadFinished&&parent.onUploadFinished()})},crop:function(a){var b=c.getImageSize().width/h._info.width;a.scale=b,h._cropData={x:a.x1,y:a.y1,width:a.width,height:a.height,scale:a.scale}},upload:function(){g.upload(),alert("上传成功")}}}(),c=function(){function g(b,c){"undefined"==typeof e&&function(){var a=new Image,c=!0;a.onload=a.onerror=function(){(1!=this.width||1!=this.height)&&(c=!1)},a.src=b,e=c}(),e?c(b):a.ajax("../../server/preview.php",{method:"POST",data:b,dataType:"json"}).done(function(a){a.result?c(a.result):alert("预览出错")})}var e,f,b=a(".cropper-wraper"),c=b.find(".img-container img"),d=a(".upload-btn");return c.cropper({aspectRatio:16/9,preview:".img-preview",done:function(){}}),d.on("click",function(){return f&&f(c.cropper("getData")),!1}),{setSource:function(a){return g(a,function(a){c.cropper("setImgSrc",a)}),b.removeClass("webuploader-element-invisible"),this},getImageSize:function(){var a=c.get(0);return{width:a.naturalWidth,height:a.naturalHeight}},setCallback:function(a){return f=a,this},disable:function(){return c.cropper("disable"),this},enable:function(){return c.cropper("enable"),this}}}(),d=a(".uploader-container");b.init(function(a){c.setSource(a),d.addClass("webuploader-element-invisible"),c.setCallback(function(a){b.crop(a),b.upload()})})});